(function(o,m){typeof exports=="object"&&typeof module<"u"?m(exports,require("ol"),require("ol/proj/Projection"),require("ol/proj"),require("ol/layer"),require("ol/source"),require("ol/format"),require("ol/style.js"),require("ol/control/defaults"),require("ol/style/Style"),require("ol/style/Text"),require("ol/tilegrid/TileGrid"),require("ol/tilegrid/WMTS"),require("ol/extent"),require("ol/control/Zoom"),require("ol-ext/control/LayerShop"),require("ol-ext/control/LayerSwitcher"),require("ol/events"),require("ol-ext/control/EditBar"),require("ol-ext/control/Toggle"),require("ol-ext/control/Notification"),require("ol/layer/Vector"),require("ol/source/Vector"),require("ol/sphere"),require("ol/style/Circle"),require("ol/style/Stroke"),require("ol/style/Fill"),require("ol/format/EsriJSON"),require("ol/format/GeoJSON"),require("ol/interaction/Select"),require("ol/interaction/Modify"),require("ol-ext/control/Button"),require("ol/interaction/DoubleClickZoom"),require("ol/proj/proj4"),require("proj4"),require("uuid"),require("ol-ext/control/Overview"),require("ol-ext/control/Swipe"),require("ol/Observable"),require("ol/Feature"),require("ol/geom/Point"),require("ol/easing"),require("ol-ext/featureAnimation/Show"),require("ol/control")):typeof define=="function"&&define.amd?define(["exports","ol","ol/proj/Projection","ol/proj","ol/layer","ol/source","ol/format","ol/style.js","ol/control/defaults","ol/style/Style","ol/style/Text","ol/tilegrid/TileGrid","ol/tilegrid/WMTS","ol/extent","ol/control/Zoom","ol-ext/control/LayerShop","ol-ext/control/LayerSwitcher","ol/events","ol-ext/control/EditBar","ol-ext/control/Toggle","ol-ext/control/Notification","ol/layer/Vector","ol/source/Vector","ol/sphere","ol/style/Circle","ol/style/Stroke","ol/style/Fill","ol/format/EsriJSON","ol/format/GeoJSON","ol/interaction/Select","ol/interaction/Modify","ol-ext/control/Button","ol/interaction/DoubleClickZoom","ol/proj/proj4","proj4","uuid","ol-ext/control/Overview","ol-ext/control/Swipe","ol/Observable","ol/Feature","ol/geom/Point","ol/easing","ol-ext/featureAnimation/Show","ol/control"],m):(o=typeof globalThis<"u"?globalThis:o||self,m(o["webgis-ol"]={},o.ol,o.ol.proj.Projection,o.ol.proj,o.ol.layer,o.ol.source,o.ol.format,o.ol.style,o.ol.control.defaults,o.ol.style.Style,o.ol.style.Text,o.ol.tilegrid.TileGrid,o.ol.tilegrid.WMTS,o.ol.extent,o.ol.control.Zoom,o.ol.control.LayerShop,o.ol.control.LayerSwitcher,o.ol.events,o.ol.control.EditBar,o.ol.control.Toggle,o.ol.control.Notification,o.ol.layer.Vector,o.ol.source.Vector,o.ol.sphere,o.ol.style.Circle,o.ol.style.Stroke,o.ol.style.Fill,o.ol.format.EsriJSON,o.ol.format.GeoJSON,o.ol.interaction.Select,o.ol.interaction.Modify,o.ol.control.Button,o.ol.interaction.DoubleClickZoom,o.ol.proj.proj4,o.proj4,o.uuid,o.ol.control.Overview,o.ol.control.Swipe,o.ol.Observable,o.ol.Feature,o.ol.geom.Point,o.ol.easing,o.ol.featureAnimation.Show,o.ol.control))})(this,function(o,m,y,q,We,xt,It,Dt,Mt,He,Nt,Ft,At,Re,qt,Vt,Bt,Gt,Wt,Ht,Qe,et,tt,Rt,it,Ue,rt,Ut,st,Zt,zt,Jt,kt,Kt,nt,Xt,Yt,Qt,ei,ti,ii,ot,ri,si){var ue,V,pe,ze,J,B,je,yt,_e,bt,k,Pe,Ct,P,T,Te,$t,K,Be,Y,Q,ee,te,me,ie,re,fe,G,Ee,ge,Je,xe,Ot,Ie,St,se,Ge,ne,De,Lt,we,ke,Me,jt,ve,Ke,Ne,_t,Fe,Pt,W,N,de,H,pt,L,oe,F,A,ae,ye,Ae,le,be,Xe,qe,Tt,R,Oe,Ce,Ye,Ve,Et,mt,U,Z,x,ce,ft,z,he,$e,gt;"use strict";var Yi=Object.defineProperty;var Qi=(o,m,y)=>m in o?Yi(o,m,{enumerable:!0,configurable:!0,writable:!0,value:y}):o[m]=y;var wt=(o,m,y)=>(Qi(o,typeof m!="symbol"?m+"":m,y),y),Ze=(o,m,y)=>{if(!m.has(o))throw TypeError("Cannot "+y)};var l=(o,m,y)=>(Ze(o,m,"read from private field"),y?y.call(o):m.get(o)),h=(o,m,y)=>{if(m.has(o))throw TypeError("Cannot add the same private member more than once");m instanceof WeakSet?m.add(o):m.set(o,y)},u=(o,m,y,q)=>(Ze(o,m,"write to private field"),q?q.call(o,y):m.set(o,y),y),vt=(o,m,y,q)=>({set _(We){u(o,m,We,y)},get _(){return l(o,m,q)}}),d=(o,m,y)=>(Ze(o,m,"access private method"),y);function Se(a){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(a){for(const e in a)if(e!=="default"){const t=Object.getOwnPropertyDescriptor(a,e);Object.defineProperty(r,e,t.get?t:{enumerable:!0,get:()=>a[e]})}}return r.default=a,Object.freeze(r)}const O=Se(We),w=Se(xt),C=Se(It),D=Se(Dt);class at{constructor(r){const e=Object.assign({},r),t=new He(e);return i=>{const s=t.getText();return s.setFeature&&s.setFeature(i),t}}}class lt extends Nt{constructor(e){super(e);h(this,pe);h(this,ue,void 0);h(this,V,void 0);u(this,V,e.text)}setFeature(e){u(this,ue,e)}getText(){try{let e;return Array.isArray(l(this,V))?e=l(this,V).map(t=>d(this,pe,ze).call(this,t)):e=d(this,pe,ze).call(this,l(this,V)),e}catch(e){console.error(e);return}}}ue=new WeakMap,V=new WeakMap,pe=new WeakSet,ze=function(e){return e.replace(/\{(.+?)\}/g,(...t)=>{var i;return(i=l(this,ue))==null?void 0:i.get(t[1])})};const ct={map:m.Map,view:m.View,projection:y,defaults:Mt.defaults,graticule:O.Graticule,group:O.Group,heatmap:O.Heatmap,image:O.Image,layer:O.Layer,mapboxvector:O.MapboxVector,tile:O.Tile,vector:O.Vector,vectorimage:O.VectorImage,vectortile:O.VectorTile,webglpoints:O.WebGLPoints,webgltile:O.WebGLTile,"bingmaps-source":w.BingMaps,"cartodb-source":w.CartoDB,"cluster-source":w.Cluster,"datatile-source":w.DataTile,"geotiff-source":w.GeoTIFF,"iiif-source":w.IIIF,"imagearcgisrest-source":w.ImageArcGISRest,"imagecanvas-source":w.ImageCanvas,"imagemapguide-source":w.ImageMapGuide,"imagestatic-source":w.ImageStatic,"imagewms-source":w.ImageWMS,"osm-source":w.OSM,"raster-source":w.Raster,"stamen-source":w.Stamen,"tilearcgisrest-source":w.TileArcGISRest,"tiledebug-source":w.TileDebug,"tileimage-source":w.TileImage,"tilejson-source":w.TileJSON,"tilewms-source":w.TileWMS,"urltile-source":w.UrlTile,"utfgrid-source":w.UTFGrid,"vector-source":w.Vector,"vectortile-source":w.VectorTile,"wmts-source":w.WMTS,tilegrid:Ft,"wmts-tilegrid":At,"xyz-source":w.XYZ,"zoomify-source":w.Zoomify,esrijson:C.EsriJSON,geojson:C.GeoJSON,gml:C.GML,gpx:C.GPX,igc:C.IGC,iiifinfo:C.IIIFInfo,kml:C.KML,mvt:C.MVT,ows:C.OWS,polyline:C.Polyline,topojson:C.TopoJSON,wfs:C.WFS,wkb:C.WKB,wkt:C.WKT,wmscapabilities:C.WMSCapabilities,wmsgetfeatureinfo:C.WMSGetFeatureInfo,wmtscapabilities:C.WMTSCapabilities,circle:D.Circle,fill:D.Fill,icon:D.Icon,iconimage:D.IconImage,regularshape:D.RegularShape,stroke:D.Stroke,style:D.Style,text:D.Text,"style-fn":at,"text-fn":lt},M=(a,r)=>{if(a===null||typeof a!="object"||r=="params"||r=="props")return a;a.type=="wmts-source"&&(a.projection=a.projection??"EPSG:3857",a.tileGrid.projection=a.projection,a.tileGrid.matrixSet=a.matrixSet);const e=JSON.parse(JSON.stringify(a));try{if(Array.isArray(e)){for(let i=0;i<e.length;i++)e[i]=M(e[i]);return e}Object.keys(e).forEach(i=>{e[i]=M(e[i],i)}),r=="source"&&(e.crossOrigin="anonymous"),r=e.type||r;const t=ht(r);if(!t)throw new Error(`Cannot find a constructor of type ${r}`);if(a.type=="wmts-tilegrid"){let i=ni(e);e.origin=i.origin,e.resolutions||(e.resolutions=i.resolutions),e.matrixIds=i.matrixIds}return new t(e)}catch(t){return console.error(t),e}};window.getObject=M;const ht=a=>{if(a)return ct[a.toLowerCase()]},ni=a=>{const r=a.projection??"EPSG:3857",e=a.maxZoom??18,t=a.minZoom??0,i=a.tileSize??256,s=a.matrixSet??"EPSG:3857",c=q.get(r).getExtent(),p=Re.getTopLeft(c),f=[],g=Re.getWidth(c)/i,b=e-t+1,E=new Array(b),v=new Array(b);for(let $=t;$<=e;$++)s.indexOf("EPSG")>-1?v[$-t]=r+":"+$:v[$-t]=$,a.tileTool=="geoserver"?E[$-t]=g/Math.pow(2,$+1):E[$-t]=g/Math.pow(2,$),f.push(p);return{origin:p,origins:f,matrixIds:v,resolutions:E}};var j=(a=>(a[a.none=0]="none",a[a.funOnly=1]="funOnly",a[a.propOnly=2]="propOnly",a[a.always=3]="always",a))(j||{});const S=a=>r=>(r.prototype._manifest=oi(a),customElements.define(a.tagName,r),r),oi=a=>(a=Object.assign({hasConfig:!1,mode:j.always},a),a),dt=a=>{Promise?Promise.resolve().then(a):requestAnimationFrame?requestAnimationFrame(a):setTimeout(a,0)},er="",ai=`<div class="error">\r
    <div class="info">\r
        <div>\r
            <p>软件未授权，请联系软件提供商，获取授权码！</p>\r
            <a href="">刷新</a>\r
        </div>\r
    </div>\r
</div>`,li=`<div class="develop">\r
    开发预览版，有限期至【】@山维科技\r
</div>`,X=class{constructor(){h(this,je);h(this,_e);h(this,Pe);h(this,Te);h(this,K);h(this,B,"开发版");h(this,k,null);h(this,P,null);h(this,T,null);if(new.target===X)return l(X,J)||u(X,J,this),l(X,J)}get authtype(){return l(this,B)}get authorized(){return d(this,_e,bt).call(this)}};let Le=X;J=new WeakMap,B=new WeakMap,je=new WeakSet,yt=function(r,e){try{if(!r||r.length<8)return"";e||(e="sunway_webgis_auth_code"),e=encodeURIComponent(e);let t="";for(let b=0;b<e.length;b+=1)t+=e.charCodeAt(b).toString();let i=Math.floor(t.length/5),s=parseInt(t.charAt(i)+t.charAt(i*2)+t.charAt(i*3)+t.charAt(i*4)+t.charAt(i*5)),n=Math.round(e.length/2),c=Math.pow(2,31)-1,p=parseInt(r.substring(r.length-8,r.length),16);for(r=r.substring(0,r.length-8),t+=p;t.length>10;)t=(parseInt(t.substring(0,10))+parseInt(t.substring(10,t.length))).toString();t=(s*t+n)%c;let f="",g="";for(let b=0;b<r.length;b+=2)f=parseInt(r.substring(b,b+2),16)^Math.floor(t/c*255),g+=String.fromCharCode(f),t=(s*t+n)%c;return decodeURIComponent(g)}catch{return""}},_e=new WeakSet,bt=function(){const r=d(this,je,yt).call(this,window.licenses),e=r.split("|")[0],t=r.split("|")[1];u(this,B,r.split("|")[2]);let i=window.location.hostname.toUpperCase();if(i==="LOCALHOST"||i=="127.0.0.1")return!0;let s=!1;if(e.split(",").forEach(f=>{if(f.toUpperCase()===i){s=!0;return}}),!s)return d(this,K,Be).call(this,"软件未授权，请联系软件提供商，获取授权码！"),!1;if(typeof t>"u")return d(this,K,Be).call(this,"软件未授权，请联系软件提供商，获取授权码！"),!1;const c=d(this,Pe,Ct).call(this),p=new Date(t);return c.getTime()>p.getTime()?(d(this,K,Be).call(this,l(this,B)+"有限期至【"+t+"】已过期，请重新授权！@山维科技"),!1):(l(this,B)!="正式版"&&d(this,Te,$t).call(this,"开发预览版，有限期至【"+t+"】@山维科技"),!0)},k=new WeakMap,Pe=new WeakSet,Ct=function(){if(!l(this,k)){const r=new window.XMLHttpRequest;r.open("GET","/",!1),r.send(null);const e=r.getResponseHeader("Date");u(this,k,new Date(e))}return l(this,k)},P=new WeakMap,T=new WeakMap,Te=new WeakSet,$t=function(r){l(this,T)||(u(this,T,document.createElement("div")),l(this,T).style.zIndex="999",l(this,T).classList.add("auth"),l(this,T).innerHTML=li,document.body.appendChild(l(this,T)));const e=l(this,T).getElementsByClassName("develop")[0];e.innerHTML=r},K=new WeakSet,Be=function(r){l(this,P)||(u(this,P,document.createElement("div")),l(this,P).style.zIndex="1000",l(this,P).classList.add("auth"),l(this,P).innerHTML=ai,document.body.appendChild(l(this,P)));const e=l(this,P).getElementsByTagName("p")[0];e.innerHTML=r},h(Le,J,void 0);class _ extends HTMLElement{constructor(){super();h(this,ge);h(this,xe);h(this,Ie);h(this,se);h(this,De);h(this,we);h(this,Me);h(this,ve);h(this,Ne);h(this,Fe);h(this,N);h(this,Y,void 0);h(this,Q,void 0);h(this,ee,void 0);h(this,te,void 0);h(this,me,void 0);h(this,ie,void 0);h(this,re,"w-l");h(this,fe,!1);h(this,G,j.none);h(this,Ee,["value","src","title"]);h(this,ne,!1);h(this,W,"unInited");new Le().authorized&&(this.manifest.hasConfig&&d(this,ge,Je).call(this,this.getAttribute("config")||this.getAttribute("configUrl")),u(this,G,this.manifest.mode??j.always),dt(()=>{d(this,Ie,St).call(this),d(this,N,de).call(this)}))}startup(e){this.mapView=e.mapView,this.map=e.map,this.mapConfig=e.mapConfig,this.config=e.config}get manifest(){return this._manifest}get mapConfig(){return l(this,Y)}set mapConfig(e){!l(this,Y)&&e&&(u(this,Y,e),d(this,N,de).call(this))}get mapView(){return l(this,Q)}set mapView(e){!l(this,Q)&&e&&(u(this,Q,e),d(this,N,de).call(this))}get map(){return l(this,ee)}set map(e){!l(this,ee)&&e&&(u(this,ee,e),d(this,N,de).call(this))}get config(){return l(this,te)}set config(e){if(typeof e=="string"){d(this,ge,Je).call(this,e);return}else typeof e=="object"&&!l(this,te)&&e&&(u(this,te,e),d(this,N,de).call(this))}get loading(){return!!l(this,me)}set loading(e){u(this,me,e),d(this,xe,Ot).call(this)}get $data(){return l(this,ie)}set $data(e){(l(this,G)&j.propOnly)==j.propOnly?(u(this,ie,d(this,se,Ge).call(this,e)),d(this,we,ke).call(this)):u(this,ie,e)}isReady(){return!!(this.map&&this.mapView&&this.mapConfig&&(this.config||!this.manifest.hasConfig))}async onInit(){}afterInit(){}onOpen(){}onClose(){}}Y=new WeakMap,Q=new WeakMap,ee=new WeakMap,te=new WeakMap,me=new WeakMap,ie=new WeakMap,re=new WeakMap,fe=new WeakMap,G=new WeakMap,Ee=new WeakMap,ge=new WeakSet,Je=async function(e){if(!this.config&&e){this.loading=!0;const t=await fetch(e);this.config=t&&t.ok&&await t.json()||{},this.loading=!1}},xe=new WeakSet,Ot=function(){this.loading?this.classList.add("loading"):this.classList.remove("loading")},Ie=new WeakSet,St=function(){const e=this.manifest.className||this.manifest.tagName;if(this.classList.add(e),this.manifest.template){let t=this.manifest.template;(l(this,G)&j.propOnly)==j.propOnly&&(t=t.replace(/\{\{(.+?)\}\}/g,(...i)=>`<${l(this,re)}>${i[1]}</${l(this,re)}>`)),this.innerHTML=t,(l(this,G)&j.funOnly)==j.funOnly&&d(this,Fe,Pt).call(this)}u(this,fe,!0)},se=new WeakSet,Ge=function(e){return typeof e=="object"&&e!==null?(Object.keys(e).forEach(t=>{e[t]=d(this,se,Ge).call(this,e[t])}),new Proxy(e,{set:(t,i,s)=>(t[i]=d(this,se,Ge).call(this,s),d(this,De,Lt).call(this),!0)})):e},ne=new WeakMap,De=new WeakSet,Lt=function(){l(this,ne)||(u(this,ne,!0),dt(()=>{d(this,we,ke).call(this),u(this,ne,!1)}))},we=new WeakSet,ke=function(){l(this,Ee).forEach(t=>{d(this,Me,jt).call(this,t)}),this.querySelectorAll(l(this,re)).forEach(t=>{const i=d(this,ve,Ke).call(this,t.origin);String(i)!==t.innerHTML&&(t.innerHTML=i)})},Me=new WeakSet,jt=function(e){const t=`s-${e}`;this.querySelectorAll(`[${t}]`).forEach(s=>{const n=s.getAttribute(t),c=d(this,ve,Ke).call(this,n);c!==s[e]&&(s[e]=c)})},ve=new WeakSet,Ke=function(e){try{return e.split(".").reduce((t,i)=>t[i],this.$data)}catch(t){console.error(t);return}},Ne=new WeakSet,_t=function(e,t){let i=this.$data,s=e.split(".");for(let n=0;n<s.length;n++){const c=s[n];n==s.length-1?i[c]=t:i=i[c]}},Fe=new WeakSet,Pt=function(){this.querySelectorAll("*").forEach(t=>{t.$this||(t.$this=this,t.$set=(i,s)=>{d(this,Ne,_t).call(this,i,s)})})},W=new WeakMap,N=new WeakSet,de=async function(){l(this,fe)&&(l(this,W)==="initing"||l(this,W)==="inited"||this.isReady()&&(u(this,W,"initing"),this.loading=!0,await this.onInit(),this.loading=!1,u(this,W,"inited"),this.afterInit()))};class ut extends _{constructor(){super()}isReady(){return!!this.config}afterInit(){this.mapConfig=this.config,this.mapView=this;const r=this.mapConfig.widgetManager||"webgis-widget-manager",e=document.createElement(r);e.startup({mapView:this,map:this.map,config:this.mapConfig.widgets,mapConfig:this.mapConfig}),this.childNodes[0]?this.insertBefore(e,this.childNodes[0]):this.appendChild(e)}}const tr="";var ci=Object.defineProperty,hi=Object.getOwnPropertyDescriptor,di=(a,r,e,t)=>{for(var i=t>1?void 0:t?hi(r,e):r,s=a.length-1,n;s>=0;s--)(n=a[s])&&(i=(t?n(r,e,i):n(i))||i);return t&&i&&ci(r,e,i),i};o.MapView=class extends ut{constructor(){super()}async onInit(){const r=M(this.config.map,"map");r.setTarget(this),this.map=r,this.getObject=M}},o.MapView=di([S({tagName:"ol-map",className:"ol-map",hasConfig:!0})],o.MapView);const ir="";var ui=Object.defineProperty,pi=Object.getOwnPropertyDescriptor,mi=(a,r,e,t)=>{for(var i=t>1?void 0:t?pi(r,e):r,s=a.length-1,n;s>=0;s--)(n=a[s])&&(i=(t?n(r,e,i):n(i))||i);return t&&i&&ui(r,e,i),i};o.ZoomWidget=class extends _{constructor(){super()}async onInit(){let r=new qt({target:this});this.map.addControl(r)}},o.ZoomWidget=mi([S({tagName:"ol-zoom-widget",className:"ol-zoom-widget"})],o.ZoomWidget);const rr="";var fi=Object.defineProperty,gi=Object.getOwnPropertyDescriptor,wi=(a,r,e,t)=>{for(var i=t>1?void 0:t?gi(r,e):r,s=a.length-1,n;s>=0;s--)(n=a[s])&&(i=(t?n(r,e,i):n(i))||i);return t&&i&&fi(r,e,i),i};o.LayerList=(pt=class extends _{constructor(){super();h(this,H,[])}async onInit(){let e=new Vt({target:this,noScroll:!0,collapsed:!1,trash:!1,extent:!0,show_progress:!1,displayInLayerSwitcher:t=>t.get("listMode")!=="hide"});e.on("drawlist",t=>{const i=t.li,s=i.getElementsByClassName("ol-layerswitcher-buttons")[0],n=i.getElementsByClassName("layerswitcher-opacity")[0];let c=document.createElement("div");c.title="透明度",c.innerHTML="%";const p=t.layer;n.style.display=l(this,H).includes(p.ol_uid)?"block":"none",c.onclick=()=>{n.style.display==="block"?(n.style.display="none",u(this,H,l(this,H).filter(g=>g!==p.ol_uid))):(n.style.display="block",l(this,H).push(p.ol_uid))},s.appendChild(c)}),this.map.addControl(e)}},H=new WeakMap,pt),o.LayerList=wi([S({tagName:"ol-layer-list",className:"ol-layer-list"})],o.LayerList);const sr="";var vi=Object.defineProperty,yi=Object.getOwnPropertyDescriptor,bi=(a,r,e,t)=>{for(var i=t>1?void 0:t?yi(r,e):r,s=a.length-1,n;s>=0;s--)(n=a[s])&&(i=(t?n(r,e,i):n(i))||i);return t&&i&&vi(r,e,i),i};o.BasemapList=class extends _{constructor(){super()}async onInit(){let r=new Ci({target:this});this.map.addControl(r)}},o.BasemapList=bi([S({tagName:"ol-basemap-list",className:"ol-basemap-list"})],o.BasemapList);class Ci extends Bt{constructor(r){r=r||{},r.switcherClass=((r.switcherClass||"")+" ol-layerswitcher-image").trim(),r.mouseover=r.mouseover!==!1,super(r)}drawList(r,e){r.style.height="auto",e.getArray().filter(i=>i.get("isBasemap")).forEach(i=>{if(this.displayInLayerSwitcher(i)){let s=document.createElement("img");s.src=i.get("thumbnail")||"images/thumbnail.png";let n=document.createElement("p");n.innerHTML=i.get("title")||i.get("name");let c=document.createElement("li");c.className="ol-imgcontainer"+(i.getVisible()?" ol-visible":""),c.appendChild(s),c.appendChild(n),c.onclick=()=>{this.switchLayerVisibility(i,e)},this._setLayerForLI(c,i),this.testLayerVisibility(i)||c.classList.add("ol-layer-hidden"),r.appendChild(c)}})}overflow(){}}const nr="",$i="<div>{{coordinate}} 比例尺 {{scale}}</div>";var Oi=Object.defineProperty,Si=Object.getOwnPropertyDescriptor,Li=(a,r,e,t)=>{for(var i=t>1?void 0:t?Si(r,e):r,s=a.length-1,n;s>=0;s--)(n=a[s])&&(i=(t?n(r,e,i):n(i))||i);return t&&i&&Oi(r,e,i),i};o.Coordinate=class extends _{constructor(){super()}async onInit(){this.$data={coordinate:"",scale:""};const r=this.map.getViewport();Gt.listen(r,"pointermove",this.handleMouseMove,this),this.map.on("moveend",this.moveEnd.bind(this))}handleMouseMove(r){const e=this.map.getEventPixel(r),t=this.map.getCoordinateFromPixelInternal(e);t&&(this.$data.coordinate=`${t[0].toFixed(3)} ${t[1].toFixed(3)}`)}moveEnd(){const r=this.getScale();(r??!1)&&(this.$data.scale=`1:${r.toLocaleString()}`)}getScale(){const r=this.map.getView(),e=25.4/.28,t=1e3/25.4;var i=1;return r.getProjection().getUnits()!="metric"?i=r.getResolution()*r.getProjection().getMetersPerUnit()*t*e:i=r.getResolution()*t*e,Math.round(i)}},o.Coordinate=Li([S({tagName:"ol-coordinate",className:"ol-coordinate",template:$i})],o.Coordinate);const or="",ji=`<div class="attribute">\r
    <table class="table">\r
\r
    </table>\r
    <div>\r
        <button class="btn" onclick="$this.delete()">删除</button>\r
        <button class="btn" onclick="$this.upload()">提交</button>\r
    </div>\r
</div>\r
<input class="shp-upload" multiple type="file" onchange="$this.readFile(event)" id="shp-upload" name="shp-upload"\r
    accept=".shp,.prj,.dbf,.shx">\r
<!-- <input class="shp-upload" type="file" onchange="$this.readFile(event)" id="shp-upload" name="shp-upload" accept=".zip"> -->`;var _i=Object.defineProperty,Pi=Object.getOwnPropertyDescriptor,Ti=(a,r,e,t)=>{for(var i=t>1?void 0:t?Pi(r,e):r,s=a.length-1,n;s>=0;s--)(n=a[s])&&(i=(t?n(r,e,i):n(i))||i);return t&&i&&_i(r,e,i),i};o.EditBar=(mt=class extends _{constructor(){super();h(this,be);h(this,qe);h(this,R);h(this,Ce);h(this,Ve);h(this,L,void 0);h(this,oe,void 0);h(this,F,void 0);h(this,A,void 0);wt(this,"notification");h(this,ae,void 0);h(this,ye,[]);h(this,Ae,0);h(this,le,void 0)}async onInit(){const e=new et({source:new tt,style:function(g){return new He({image:new it({radius:5,stroke:new Ue({width:1.5,color:g.get("color")||[255,128,0]}),fill:new rt({color:(g.get("color")||[255,128,0]).concat([.3])})}),stroke:new Ue({width:2.5,color:g.get("color")||[255,128,0]}),fill:new rt({color:(g.get("color")||[255,128,0]).concat([.3])})})}});e.set("listMode","hide"),this.map.addLayer(e),u(this,oe,e);let t={edition:!0,select:!1,delete:!1,info:!1,drawPoint:!0,drawLine:!0,drawPolygon:!0,drawHole:!0,drawRegular:!0,transform:!0,split:!0,offset:!0};t=Object.assign(t,this.config.tools);const i=new Wt({source:e.getSource(),target:this,interactions:{Select:!1,Delete:!1,Info:!1,DrawPoint:t.drawPoint&&{title:"绘制点"},DrawLine:t.drawLine&&{title:"绘制线"},DrawPolygon:t.drawPolygon&&{title:"绘制面"},DrawHole:t.drawHole&&{title:"绘制岛面"},DrawRegular:t.drawRegular&&{title:"绘制多边形",ptsLabel:"边"},Transform:t.transform&&{title:"旋转/缩放"},Split:t.split&&{title:"打断"},Offset:t.offset&&{title:"偏移"},UndoDraw:"回退",FinishDraw:"完成"}}),s=new Zt({layers:[e]});s.on("change:active",()=>{s.getActive()||(s.getFeatures().clear(),d(this,R,Oe).call(this))}),s.on("select",g=>{d(this,qe,Tt).call(this,g)}),u(this,A,new zt({features:s.getFeatures()})),this.map.addInteraction(l(this,A)),l(this,A).setActive(!1);const n=new Ht({html:'<div class="attr-edit">☰</div>',title:"属性编辑",interaction:s});i.addControl(n);const c=this.map.interactions.getArray().find(g=>g instanceof kt);[i.getInteraction("DrawPoint"),i.getInteraction("DrawLine"),i.getInteraction("DrawPolygon"),i.getInteraction("DrawHole"),i.getInteraction("DrawRegular")].forEach(g=>{g==null||g.on("drawend",b=>{c.setActive(!1),d(this,be,Xe).call(this,b.feature),setTimeout(()=>{c.setActive(!0)},0)})}),u(this,le,s);const f=new Jt({html:'<div class="upload"><label>➜</label></div>',title:"上传shp",handleClick:()=>this.uploadShp()});i.addControl(f),this.map.addControl(i),this.notification=new Qe({}),this.map.addControl(this.notification)}uploadShp(){u(this,ae,l(this,ae)||this.getElementsByClassName("shp-upload")[0]),l(this,ae).click()}async readFile(e){var s;const t=e.currentTarget,i=t.files;if(i.length!==0){this.loading=!0;try{let n,c;for(let v=0;v<i.length;v++){const[$,I]=i[v].name.split(".");if(I.toLowerCase()==="shp"){n=$,c=i[v];break}}if(!c)throw new Error("没有找到shp文件");const p=await this.loadFile(c);if(!p)throw new Error("读取文件失败");let f=await window.shp(p).then(v=>v,v=>{throw new Error(v)}),g;for(let v=0;v<i.length;v++){const[$,I]=i[v].name.split(".");if(I.toLowerCase()==="prj"&&$==n){g=i[v];break}}let b;if(g){let v=await this.loadFile(g,"text");v=v.replace("Gauss_Kruger","Transverse_Mercator");let $=l(this,ye).find(Xi=>Xi.prj===v),I;$?I=$.name:(I=`ESRI:${vt(this,Ae)._++}`,l(this,ye).push({name:I,prj:v}),nt.defs(I,v),Kt.register(nt));const Ki=this.map.getView().getProjection().getCode();b=new st().readFeatures(f,{dataProjection:I,featureProjection:Ki})}else b=new st().readFeatures(f);const E=b[0];if(E){l(this,oe).getSource().addFeature(E);const v=(s=E.getGeometry())==null?void 0:s.getExtent();this.map.getView().fit(v,{padding:[50,50,50,50],duration:1e3}),d(this,be,Xe).call(this,E)}else throw new Error("没有找到上传的图形")}catch(n){console.error(n),this.notification.show(n)}finally{t.value=null,this.loading=!1}}}loadFile(e,t){return new Promise((i,s)=>{const n=new FileReader;switch(t){case"text":n.readAsText(e);break;case"buffer":n.readAsArrayBuffer(e);break;case"binary":n.readAsBinaryString(e);break;default:n.readAsDataURL(e);break}n.onload=c=>{var f;let p=(f=c.target)==null?void 0:f.result;i(p)},n.onerror=c=>{n.abort(),s(c)}})}delete(){l(this,oe).getSource().removeFeature(l(this,F)),u(this,F,null),d(this,R,Oe).call(this)}getDate(e){let t;if(e)typeof e=="string"?t=new Date(e):t=e;else return"";const i=t.getFullYear(),s=t.getMonth()+1,n=t.getDate();return`${this.pad(i,4)}-${this.pad(s)}-${this.pad(n)}`}pad(e,t=2,i="0"){return e.toString().padStart(t,i)}getTime(e){let t;if(e)typeof e=="string"?t=new Date(e):t=e;else return"";return t.toLocaleTimeString("zh-cn",{hour:"numeric",minute:"numeric",hour12:!1})}getDefaultValue(e,t){let i="";try{switch(t==null?void 0:t.toLowerCase()){case"$guid":i=`{${Xt.v4()}}`;break;case"$date":let s=new Date;i=`${this.getDate(s)} ${this.getTime(s)}`;break;case"$area":const n=e.getGeometry();n&&(i=Rt.getArea(n,{projection:this.map.getView().getProjection()}).toFixed(3));break;default:i=t||"";break}}catch(s){console.error(s)}return i}upload(){if(!l(this,F)){this.notification.show("请先绘制一个图形");return}let e=new Ut().writeFeaturesObject([l(this,F)],{featureProjection:this.map.getView().getProjection()});e=this.beforeUpload(e);let t=`features=${JSON.stringify(e.features)}&rollbackOnFailure=true&f=pjson`;const i=this.config.layer.url+"/addFeatures";fetch(i,{method:"POST",body:t,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(s=>s.json()).then(s=>{if(s.error){const n=s.error.details[0]||s.error.message;this.notification.show(`提交失败 ${n}`),console.error(s.error),this.afterUpload(!1)}else this.notification.show("提交完成"),this.delete(),this.map.getAllLayers().forEach(n=>{var c;((c=n.get("type"))==null?void 0:c.toLowerCase())==="image"&&n.getSource().refresh()}),this.afterUpload(!0)}).catch(s=>{console.error(s),this.afterUpload(!1)})}beforeUpload(e){return e}afterUpload(e){}},L=new WeakMap,oe=new WeakMap,F=new WeakMap,A=new WeakMap,ae=new WeakMap,ye=new WeakMap,Ae=new WeakMap,le=new WeakMap,be=new WeakSet,Xe=function(e){l(this,le).setActive(!0),l(this,le).getFeatures().extend([e]),d(this,Ce,Ye).call(this,e)},qe=new WeakSet,Tt=function(e){const t=e.target.getFeatures(),i=t.getLength();if(i===0)d(this,R,Oe).call(this);else if(i>1)d(this,R,Oe).call(this);else{const s=t.getArray()[0];d(this,Ce,Ye).call(this,s)}},R=new WeakSet,Oe=function(){l(this,A).setActive(!1),u(this,L,l(this,L)||this.getElementsByClassName("attribute")[0]),l(this,L).style.display="none"},Ce=new WeakSet,Ye=function(e){l(this,A).setActive(!0),u(this,F,e);let t=this.config.layer.fields||[],i=document.createElement("table");i.classList.add("table"),t.forEach(s=>{let n=document.createElement("tr"),c=document.createElement("td");c.innerHTML=s.alias||s.name;let p=document.createElement("td");p.appendChild(d(this,Ve,Et).call(this,e,s)),n.appendChild(c),n.appendChild(p),n.style.display=s.isDisplay===!1?"none":"table-row",i.appendChild(n)}),u(this,L,l(this,L)||this.getElementsByClassName("attribute")[0]),l(this,L).replaceChild(i,l(this,L).firstChild),l(this,L).style.display="block"},Ve=new WeakSet,Et=function(e,t){var s,n;let i=e.get(t.name)||this.getDefaultValue(e,t.defaultValue);if(e.set(t.name,i),((s=t.type)==null?void 0:s.toLowerCase())==="date"){let c=document.createElement("div"),p=document.createElement("input");p.type="date",p.value=this.getDate(i);let f=document.createElement("input");return f.type="time",f.value=this.getTime(i),f.oninput=p.oninput=()=>{e.set(t.name,`${p.value} ${f.value}`)},t.editable==!1&&(p.readOnly=!0,f.readOnly=!0),c.appendChild(p),c.appendChild(f),c.classList.add("date-time"),c}else{let c=document.createElement("input");t.editable==!1&&(c.readOnly=!0);let p;switch((n=t.type)==null?void 0:n.toLowerCase()){case"string":p="text";break;case"guid":p="text";break;case"int":p="number";break;case"double":p="number";break;default:p="text";break}return c.type=p,c.oninput=f=>{e.set(t.name,f.target.value)},c.value=i,c}},mt),o.EditBar=Ti([S({tagName:"ol-edit-bar",className:"ol-edit-bar",template:ji})],o.EditBar);const ar="",Ei=`<div s-title="title" class="btn" onclick="$this.btnClick(event)">\r
    <div class="arrow">&#8678</div>\r
</div>`;var xi=Object.defineProperty,Ii=Object.getOwnPropertyDescriptor,Di=(a,r,e,t)=>{for(var i=t>1?void 0:t?Ii(r,e):r,s=a.length-1,n;s>=0;s--)(n=a[s])&&(i=(t?n(r,e,i):n(i))||i);return t&&i&&xi(r,e,i),i};o.Overview=class extends _{constructor(){super()}async onInit(){this.$data={title:"显示鹰眼图",display:!1},this.classList.add("overview-hide");const r=this.mapConfig.map.layers.filter(i=>i.isBasemap===!0),e=M(r,"map");let t=new Yt({target:this,layers:e,rotation:!0,panAnimation:!0,minZoom:0,maxZoom:20});this.map.addControl(t)}btnClick(){this.$data.display=!this.$data.display,this.$data.display?(this.$data.title="隐藏鹰眼图",this.classList.remove("overview-hide")):(this.$data.title="显示鹰眼图",this.classList.add("overview-hide"))}},o.Overview=Di([S({tagName:"ol-overview",className:"ol-overview",template:Ei})],o.Overview);const lr="",Mi=`<div class="header">\r
    <label>卷帘开关</label>\r
    <input type="checkbox" class="switch" id="switch" onclick="$this.switchChange(event)">\r
    <label for="switch"></label>\r
</div>\r
<div class="left">\r
    <div class="title">左侧</div>\r
    <div class="layer-list-left">\r
    </div>\r
</div>\r
<div class="right">\r
    <div class="title">右侧</div>\r
    <div class="layer-list-right">\r
    </div>\r
</div>`;var Ni=Object.defineProperty,Fi=Object.getOwnPropertyDescriptor,Ai=(a,r,e,t)=>{for(var i=t>1?void 0:t?Fi(r,e):r,s=a.length-1,n;s>=0;s--)(n=a[s])&&(i=(t?n(r,e,i):n(i))||i);return t&&i&&Ni(r,e,i),i};o.Swipe=(ft=class extends _{constructor(){super();h(this,U,void 0);h(this,Z,void 0);h(this,x,void 0);h(this,ce,[])}async onInit(){u(this,x,new Qt),this.drawList();let e=this.map.getLayerGroup().getLayers();e.on("change:length",()=>{this.drawList(),this.listen(e)}),this.listen(e)}removeListeners(){l(this,ce).forEach(e=>{ei.unByKey(e)}),u(this,ce,[])}listen(e){this.removeListeners(),e.getArray().forEach(t=>{l(this,ce).push(t.on("change:visible",()=>{this.drawList()}))})}switchChange(e){e.target.checked?this.map.addControl(l(this,x)):this.map.removeControl(l(this,x))}drawList(){u(this,U,l(this,U)||this.getElementsByClassName("layer-list-left")[0]),u(this,Z,l(this,Z)||this.getElementsByClassName("layer-list-right")[0]);let e=[];this.getLayers(this.map.getLayers(),e),l(this,U).innerHTML="",l(this,U).appendChild(this.createUl(e,"left")),l(this,Z).innerHTML="",l(this,Z).appendChild(this.createUl(e,"right"))}getLayers(e,t){e.getArray().forEach(i=>{i.getLayers&&i.getVisible()?this.getLayers(i.getLayers(),t):i.getVisible()&&t.push(i)})}createUl(e,t){const i=document.createElement("ul");return e.forEach(s=>{let n=s.ol_uid,c=s.get("title");const p=s.get("isBasemap");if(n&&c){n=`${t}_${n}`,c=p?`${c}（底图）`:c;const f=document.createElement("li");f.innerHTML=`<div class="checkbox"><input type="checkbox" id="${n}">
                <label for="${n}" title="${c}"><span>${c}</span></label></div>`;const g=f.getElementsByTagName("input")[0];g.onclick=b=>{let E=b.target.checked;this.onLayerClick({layer:s,type:t,checked:E})},g.checked=this.getCheckBoxState(s,t),i.appendChild(f)}}),i}getCheckBoxState(e,t){const i=l(this,x).layers;for(var s=0;s<i.length;s++)if(i[s].layer===e&&i[s].right===(t==="right"))return!0;return!1}onLayerClick(e){if(l(this,x).removeLayer(e.layer),e.checked){const i=`${e.type==="right"?"left":"right"}_${e.layer.ol_uid}`,s=document.getElementById(i);s.checked=!1,l(this,x).addLayer(e.layer,e.type==="right")}}},U=new WeakMap,Z=new WeakMap,x=new WeakMap,ce=new WeakMap,ft),o.Swipe=Ai([S({tagName:"ol-swipe",className:"ol-swipe-widget",template:Mi})],o.Swipe);class qi extends ri{constructor(e){e=e||{};super(e);h(this,z,0);h(this,he,0)}animate(e){const t=this.easing_(e.elapsed);if(t){let i=e.style,s,n;for(s=0;s<i.length;s++)n=i[s].getImage(),n&&n.getRadius&&(u(this,he,l(this,he)||n.getRadius()),n.setRadius(l(this,he)*t),n.setOpacity(1-t),u(this,z,l(this,z)||n.getStroke().getWidth()),n.getStroke().setWidth(l(this,z)-l(this,z)*t));this.drawGeom_(e,e.geom)}return e.time<=this.duration_}}z=new WeakMap,he=new WeakMap;const cr="",Vi=`<div class="row">\r
    <div class="label">坐标系:</div>\r
    <div class="div">\r
        <select s-value="prj" name="prj" onchange="$this.$data.prj=value">\r
            <option value="4326">地理坐标（经纬度）</option>\r
            <option value="3857">投影坐标（平面坐标）</option>\r
        </select>\r
    </div>\r
</div>\r
<div class="row">\r
    <div class="label">X:</div>\r
    <div class="div">\r
        <input type="number" s-value="x" oninput="$this.$data.x=value">\r
    </div>\r
\r
</div>\r
<div class="row">\r
    <div class="label">Y:</div>\r
    <div class="div">\r
        <input type="number" s-value="y" oninput="$this.$data.y=value">\r
    </div>\r
</div>\r
<div class="row btn">\r
    <button onclick="$this.submit()">定位</button>\r
</div>`;var Bi=Object.defineProperty,Gi=Object.getOwnPropertyDescriptor,Wi=(a,r,e,t)=>{for(var i=t>1?void 0:t?Gi(r,e):r,s=a.length-1,n;s>=0;s--)(n=a[s])&&(i=(t?n(r,e,i):n(i))||i);return t&&i&&Bi(r,e,i),i};o.Location=(gt=class extends _{constructor(){super();h(this,$e,void 0)}async onInit(){this.$data={x:null,y:null,prj:"4326"},this.notification=new Qe({}),this.map.addControl(this.notification),u(this,$e,new et({source:new tt})),l(this,$e).setMap(this.map)}submit(){if(this.$data.x&&this.$data.y){const e=q.transform([this.$data.x,this.$data.y],`EPSG:${this.$data.prj}`,this.map.getView().getProjection()),t=this.map.getView().getProjection().getExtent();Re.containsCoordinate(t,e)?(this.map.getView().animate({center:e,duration:100}),this.pulse(e)):this.notification.show("坐标超出地图范围！")}else this.notification.show("请输入坐标！")}pulse(e){for(let t=0;t<4;t++)setTimeout(()=>{this.pulseFeature(e)},t*500)}pulseFeature(e,t=3e3){let i=new ti(new ii(e));i.setStyle(new He({image:new it({radius:24,stroke:new Ue({color:"rgb(255,0,0)",width:3})})})),this.map.animateFeature(i,new qi({fade:ot.easeOut,duration:t,easing:ot.easeOut}))}},$e=new WeakMap,gt),o.Location=Wi([S({tagName:"ol-location",className:"ol-location",template:Vi})],o.Location);const hr="",Hi=`<fieldset>\r
    <legend>\r
        数据解析\r
    </legend>\r
    <div>\r
        <button onclick="$this.add(event)">测试加一</button>\r
        结果：{{a}}\r
    </div>\r
\r
    <div>\r
        <button onclick="$this.changeName(event)">测试人名</button>\r
        你是：{{b}}\r
    </div>\r
\r
\r
    <div>\r
        <button onclick="$this.changeValue(event)">测试多重属性</button>\r
        c.d.e : {{c.d.e}}\r
    </div>\r
\r
\r
    <div>\r
        <button onclick="$this.changeArr(event)">测试数组</button>\r
        数组长度：{{f.length}}\r
    </div>\r
</fieldset>\r
\r
\r
<fieldset>\r
    <legend>\r
        事件数据绑定\r
    </legend>\r
    <div>\r
        <input oninput="$this.$data.aa=value">\r
        <br>\r
        结果：{{aa}}\r
    </div>\r
</fieldset>\r
\r
<fieldset>\r
    <legend>\r
        属性绑定 + 直接赋值\r
    </legend>\r
    <div>\r
        <input s-value="bb" oninput="$this.$data.bb=value">\r
        <br>\r
        结果：{{bb}}\r
    </div>\r
</fieldset>\r
\r
<fieldset>\r
    <legend>\r
        属性绑定 + 绑定赋值\r
    </legend>\r
    <div>\r
        <input s-value="cc" oninput="$set('cc',value)">\r
        <!-- <input s-value="cc" oninput="console.log(this)"> -->\r
        <br>\r
        结果：{{cc}}\r
    </div>\r
</fieldset>`;var Ri=Object.defineProperty,Ui=Object.getOwnPropertyDescriptor,Zi=(a,r,e,t)=>{for(var i=t>1?void 0:t?Ui(r,e):r,s=a.length-1,n;s>=0;s--)(n=a[s])&&(i=(t?n(r,e,i):n(i))||i);return t&&i&&Ri(r,e,i),i};o.HelloWorld=class extends _{constructor(){super()}async onInit(){this.$data={a:1,b:"张三",c:{d:{e:1}},f:[1],aa:"123",bb:"start",cc:"121"}}hello(r){console.log(r),this.$data.c.d="和了了了了了了"}changeName(){this.$data.b=this.$data.b=="张三"?"李四":"张三"}changeValue(){this.$data.c.d={e:this.$data.c.d.e+1}}changeArr(){this.$data.f.push(1)}add(){this.$data.a++}kill(){return"hello"}},o.HelloWorld=Zi([S({tagName:"ol-hello-world",className:"ol-hello-world",template:Hi})],o.HelloWorld);const dr="";var zi=Object.defineProperty,Ji=Object.getOwnPropertyDescriptor,ki=(a,r,e,t)=>{for(var i=t>1?void 0:t?Ji(r,e):r,s=a.length-1,n;s>=0;s--)(n=a[s])&&(i=(t?n(r,e,i):n(i))||i);return t&&i&&zi(r,e,i),i};o.MapViewTest=class extends ut{constructor(){super()}async onInit(){const r=M(this.config.map,"map");r.setTarget(this),r.addControl(new si.MousePosition),this.map=r}},o.MapViewTest=ki([S({tagName:"ol-map-test",className:"ol-map-test",hasConfig:!0})],o.MapViewTest),o.Objects=ct,o.StyleFn=at,o.TextFn=lt,o.getConstructor=ht,o.getObject=M,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})});
