(function(h,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("cesium")):typeof define=="function"&&define.amd?define(["exports","cesium"],c):(h=typeof globalThis<"u"?globalThis:h||self,c(h["webgis-cesium"]={},h.Cesium))})(this,function(h,c){var M,b,z,ct,F,ft,T,W,ut,m,y,G,dt,A,et,L,S,P,E,$,V,_,N,O,X,R,rt,k,pt,J,gt,H,it,j,K,mt,q,at,Q,yt,x,ot,Y,wt,Z,Ct,v,w,D;"use strict";var nt=(h,c,u)=>{if(!c.has(h))throw TypeError("Cannot "+u)};var s=(h,c,u)=>(nt(h,c,"read from private field"),u?u.call(h):c.get(h)),n=(h,c,u)=>{if(c.has(h))throw TypeError("Cannot add the same private member more than once");c instanceof WeakSet?c.add(h):c.set(h,u)},f=(h,c,u,B)=>(nt(h,c,"write to private field"),B?B.call(h,u):c.set(h,u),u);var o=(h,c,u)=>(nt(h,c,"access private method"),u);function u(a){const i=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(a){for(const t in a)if(t!=="default"){const e=Object.getOwnPropertyDescriptor(a,t);Object.defineProperty(i,t,e.get?e:{enumerable:!0,get:()=>a[t]})}}return i.default=a,Object.freeze(i)}const B=u(c);var g=(a=>(a[a.none=0]="none",a[a.funOnly=1]="funOnly",a[a.propOnly=2]="propOnly",a[a.always=3]="always",a))(g||{});const bt=a=>i=>(i.prototype._manifest=Ot(a),customElements.define(a.tagName,i),i),Ot=a=>(a=Object.assign({hasConfig:!1,mode:g.always},a),a),ht=a=>{Promise?Promise.resolve().then(a):requestAnimationFrame?requestAnimationFrame(a):setTimeout(a,0)},Pt="",vt=`<div class="error">\r
    <div class="info">\r
        <div>\r
            <p>软件未授权，请联系软件提供商，获取授权码！</p>\r
            <a href="">刷新</a>\r
        </div>\r
    </div>\r
</div>`,Mt=`<div class="develop">\r
    开发预览版，有限期至【】@山维科技\r
</div>`,I=class{constructor(){n(this,z);n(this,F);n(this,W);n(this,G);n(this,A);n(this,b,"开发版");n(this,T,null);n(this,m,null);n(this,y,null);if(new.target===I)return s(I,M)||f(I,M,this),s(I,M)}get authtype(){return s(this,b)}get authorized(){return o(this,F,ft).call(this)}};let U=I;M=new WeakMap,b=new WeakMap,z=new WeakSet,ct=function(i,t){try{if(!i||i.length<8)return"";t||(t="sunway_webgis_auth_code"),t=encodeURIComponent(t);let e="";for(let C=0;C<t.length;C+=1)e+=t.charCodeAt(C).toString();let r=Math.floor(e.length/5),l=parseInt(e.charAt(r)+e.charAt(r*2)+e.charAt(r*3)+e.charAt(r*4)+e.charAt(r*5)),d=Math.round(t.length/2),p=Math.pow(2,31)-1,st=parseInt(i.substring(i.length-8,i.length),16);for(i=i.substring(0,i.length-8),e+=st;e.length>10;)e=(parseInt(e.substring(0,10))+parseInt(e.substring(10,e.length))).toString();e=(l*e+d)%p;let tt="",lt="";for(let C=0;C<i.length;C+=2)tt=parseInt(i.substring(C,C+2),16)^Math.floor(e/p*255),lt+=String.fromCharCode(tt),e=(l*e+d)%p;return decodeURIComponent(lt)}catch{return""}},F=new WeakSet,ft=function(){const i=o(this,z,ct).call(this,window.licenses),t=i.split("|")[0],e=i.split("|")[1];f(this,b,i.split("|")[2]);let r=window.location.hostname.toUpperCase();if(r==="LOCALHOST"||r=="127.0.0.1")return!0;let l=!1;if(t.split(",").forEach(tt=>{if(tt.toUpperCase()===r){l=!0;return}}),!l)return o(this,A,et).call(this,"软件未授权，请联系软件提供商，获取授权码！"),!1;if(typeof e>"u")return o(this,A,et).call(this,"软件未授权，请联系软件提供商，获取授权码！"),!1;const p=o(this,W,ut).call(this),st=new Date(e);return p.getTime()>st.getTime()?(o(this,A,et).call(this,s(this,b)+"有限期至【"+e+"】已过期，请重新授权！@山维科技"),!1):(s(this,b)!="正式版"&&o(this,G,dt).call(this,"开发预览版，有限期至【"+e+"】@山维科技"),!0)},T=new WeakMap,W=new WeakSet,ut=function(){if(!s(this,T)){const i=new window.XMLHttpRequest;i.open("GET","/",!1),i.send(null);const t=i.getResponseHeader("Date");f(this,T,new Date(t))}return s(this,T)},m=new WeakMap,y=new WeakMap,G=new WeakSet,dt=function(i){s(this,y)||(f(this,y,document.createElement("div")),s(this,y).style.zIndex="999",s(this,y).classList.add("auth"),s(this,y).innerHTML=Mt,document.body.appendChild(s(this,y)));const t=s(this,y).getElementsByClassName("develop")[0];t.innerHTML=i},A=new WeakSet,et=function(i){s(this,m)||(f(this,m,document.createElement("div")),s(this,m).style.zIndex="1000",s(this,m).classList.add("auth"),s(this,m).innerHTML=vt,document.body.appendChild(s(this,m)));const t=s(this,m).getElementsByTagName("p")[0];t.innerHTML=i},n(U,M,void 0);class Tt extends HTMLElement{constructor(){super();n(this,R);n(this,k);n(this,J);n(this,H);n(this,K);n(this,q);n(this,Q);n(this,x);n(this,Y);n(this,Z);n(this,w);n(this,L,void 0);n(this,S,void 0);n(this,P,void 0);n(this,E,void 0);n(this,$,void 0);n(this,V,void 0);n(this,_,"w-l");n(this,N,!1);n(this,O,g.none);n(this,X,["value","src","title"]);n(this,j,!1);n(this,v,"unInited");new U().authorized&&(this.manifest.hasConfig&&o(this,R,rt).call(this,this.getAttribute("config")||this.getAttribute("configUrl")),f(this,O,this.manifest.mode??g.always),ht(()=>{o(this,J,gt).call(this),o(this,w,D).call(this)}))}startup(t){this.mapView=t.mapView,this.map=t.map,this.mapConfig=t.mapConfig,this.config=t.config}get manifest(){return this._manifest}get mapConfig(){return s(this,L)}set mapConfig(t){!s(this,L)&&t&&(f(this,L,t),o(this,w,D).call(this))}get mapView(){return s(this,S)}set mapView(t){!s(this,S)&&t&&(f(this,S,t),o(this,w,D).call(this))}get map(){return s(this,P)}set map(t){!s(this,P)&&t&&(f(this,P,t),o(this,w,D).call(this))}get config(){return s(this,E)}set config(t){if(typeof t=="string"){o(this,R,rt).call(this,t);return}else typeof t=="object"&&!s(this,E)&&t&&(f(this,E,t),o(this,w,D).call(this))}get loading(){return!!s(this,$)}set loading(t){f(this,$,t),o(this,k,pt).call(this)}get $data(){return s(this,V)}set $data(t){(s(this,O)&g.propOnly)==g.propOnly?(f(this,V,o(this,H,it).call(this,t)),o(this,q,at).call(this)):f(this,V,t)}isReady(){return!!(this.map&&this.mapView&&this.mapConfig&&(this.config||!this.manifest.hasConfig))}async onInit(){}afterInit(){}onOpen(){}onClose(){}}L=new WeakMap,S=new WeakMap,P=new WeakMap,E=new WeakMap,$=new WeakMap,V=new WeakMap,_=new WeakMap,N=new WeakMap,O=new WeakMap,X=new WeakMap,R=new WeakSet,rt=async function(t){if(!this.config&&t){this.loading=!0;const e=await fetch(t);this.config=e&&e.ok&&await e.json()||{},this.loading=!1}},k=new WeakSet,pt=function(){this.loading?this.classList.add("loading"):this.classList.remove("loading")},J=new WeakSet,gt=function(){const t=this.manifest.className||this.manifest.tagName;if(this.classList.add(t),this.manifest.template){let e=this.manifest.template;(s(this,O)&g.propOnly)==g.propOnly&&(e=e.replace(/\{\{(.+?)\}\}/g,(...r)=>`<${s(this,_)}>${r[1]}</${s(this,_)}>`)),this.innerHTML=e,(s(this,O)&g.funOnly)==g.funOnly&&o(this,Z,Ct).call(this)}f(this,N,!0)},H=new WeakSet,it=function(t){return typeof t=="object"&&t!==null?(Object.keys(t).forEach(e=>{t[e]=o(this,H,it).call(this,t[e])}),new Proxy(t,{set:(e,r,l)=>(e[r]=o(this,H,it).call(this,l),o(this,K,mt).call(this),!0)})):t},j=new WeakMap,K=new WeakSet,mt=function(){s(this,j)||(f(this,j,!0),ht(()=>{o(this,q,at).call(this),f(this,j,!1)}))},q=new WeakSet,at=function(){s(this,X).forEach(e=>{o(this,Q,yt).call(this,e)}),this.querySelectorAll(s(this,_)).forEach(e=>{const r=o(this,x,ot).call(this,e.origin);String(r)!==e.innerHTML&&(e.innerHTML=r)})},Q=new WeakSet,yt=function(t){const e=`s-${t}`;this.querySelectorAll(`[${e}]`).forEach(l=>{const d=l.getAttribute(e),p=o(this,x,ot).call(this,d);p!==l[t]&&(l[t]=p)})},x=new WeakSet,ot=function(t){try{return t.split(".").reduce((e,r)=>e[r],this.$data)}catch(e){console.error(e);return}},Y=new WeakSet,wt=function(t,e){let r=this.$data,l=t.split(".");for(let d=0;d<l.length;d++){const p=l[d];d==l.length-1?r[p]=e:r=r[p]}},Z=new WeakSet,Ct=function(){this.querySelectorAll("*").forEach(e=>{e.$this||(e.$this=this,e.$set=(r,l)=>{o(this,Y,wt).call(this,r,l)})})},v=new WeakMap,w=new WeakSet,D=async function(){s(this,N)&&(s(this,v)==="initing"||s(this,v)==="inited"||this.isReady()&&(f(this,v,"initing"),this.loading=!0,await this.onInit(),this.loading=!1,f(this,v,"inited"),this.afterInit()))};class At extends Tt{constructor(){super()}isReady(){return!!this.config}afterInit(){this.mapConfig=this.config,this.mapView=this;const i=this.mapConfig.widgetManager||"webgis-widget-manager",t=document.createElement(i);t.startup({mapView:this,map:this.map,config:this.mapConfig.widgets,mapConfig:this.mapConfig}),this.childNodes[0]?this.insertBefore(t,this.childNodes[0]):this.appendChild(t)}}const Et="";var It=Object.defineProperty,Lt=Object.getOwnPropertyDescriptor,St=(a,i,t,e)=>{for(var r=e>1?void 0:e?Lt(i,t):i,l=a.length-1,d;l>=0;l--)(d=a[l])&&(r=(e?d(i,t,r):d(r))||r);return e&&r&&It(i,t,r),r};h.MapView=class extends At{constructor(){super()}async onInit(){window.CESIUM_BASE_URL="./third_party/Cesium/";const i=new B.Viewer(this,{homeButton:!0,timeline:!1,sceneModePicker:!0,animation:!1});i.cesiumWidget.creditContainer.style.display="none",i.baseLayerPicker.viewModel.selectedImagery=i.baseLayerPicker.viewModel.imageryProviderViewModels[3],i.scene.debugShowFramesPerSecond=!0,this.map=i}},h.MapView=St([bt({tagName:"cesium-map",className:"cesium-map",hasConfig:!0})],h.MapView),Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
